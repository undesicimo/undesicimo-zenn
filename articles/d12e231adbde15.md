---
title: "ä»Šè©±é¡Œã¨ãªã£ã¦ã„ã‚‹React 19ã®Suspenseã®å¤‰æ›´å†…å®¹ã‚’è©³ã—ãè¦‹ã¦ã¿ã¾ã—ãŸã€‚"
emoji: "ğŸ”¥"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [react, react-query, nextjs, remix, react-router]
published: true
---

## ã¯ã˜ã‚ã«

ä»¥ä¸‹ã®ãƒ„ã‚¤ãƒ¼ãƒˆãŒç™ºç«¯ã§ã—ãŸã€‚

https://x.com/TkDodo/status/1800501040766144676

æŠ•ç¨¿è€…ã¯ã€React Query ã®ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚¿ã® tkdodo ã•ã‚“ã§ã™ã€‚

React 19 ã«å«ã¾ã‚Œã‚‹å¤‰æ›´ã«ã‚ã‚‹ç•°å¤‰ã‚’æ°—ã¥ãã¾ã—ãŸã€‚
å¤‰æ›´ã¯ä»¥ä¸‹ã«è©²å½“ã—ã¾ã™

> react: Donâ€™t prerender siblings of suspended component #26380

ãƒªãƒªãƒ¼ã‚¹ãƒãƒ¼ãƒˆã«éš…ã£ã“ã«ã‚ã‚Šã¾ã—ãŸã€‚
https://react.dev/blog/2024/04/25/react-19-upgrade-guide#other-notable-changes

ã“ã®å¤‰æ›´ã¯ RFC ãªã—ã§å«ã¾ã‚Œã¾ã—ãŸã€‚è©²å½“ PR ã¯ä»¥ä¸‹
https://github.com/facebook/react/pull/26380

## What

React ã§ã¯ã€ Suspense ã‚’ä½¿ã£ã¦ã€éåŒæœŸå‡¦ç†ã‚’è¡Œã†ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚„`React.lazy`ã«ã‚ˆã£ã¦ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®é…å»¶ãƒ­ãƒ¼ãƒ‰æ™‚ã«ã€èª­ã¿è¾¼ã¿ã‚’å®Œäº†ã™ã‚‹ã¾ã§ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’è¡¨ç¤ºã•ã›ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ä»¥ä¸‹ã®ã‚ˆã†ãªå®Ÿè£…ãŒã‚ã‚‹ã¨ã—ã¾ã™ã€‚

```ts:App.tsx
import { lazy, Suspense, useState } from "react";

const AvatarComponent = lazy(() => import("./AvatarComponent"));
const InfoComponent = lazy(() => import("./InfoComponents.tsx"));
const MoreInfoComponent = lazy(() => import("./MoreInfoComponent.tsx"));

export default function App() {
  const [details, setDetails] = useState(false);
  return (
    <div className='App'>
      {!details && <button onClick={() => setDetails(true)}>CLICK ME</button>}
      {details && (
        <Suspense fallback={<div className='loader'></div>}>
          <AvatarComponent />
          <InfoComponent />
          <MoreInfoComponent />
        </Suspense>
      )}
    </div>
  );
}

```

ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŸã¡ã‚’é…å»¶ãƒ­ãƒ¼ãƒ‰ã—ã¦ã€fetch ã•ã‚Œãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã•ã‚Œã‚‹ã¾ã§ã€Suspense ã§ãƒ­ãƒ¼ãƒ‰ä¸­ã®çŠ¶æ…‹ã‚’è¡¨ç¤ºã™ã‚‹ã“ã¨ã‚’ã—ã¦ã„ã¾ã™ã€‚

React 18 ã¾ã§ã¯ã€ï¼’ã¤ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ã¾ã¨ã‚ã¦ã²ã¨ã¤ã® Suspense ã«å›²ã‚“ã§ã‚‚ã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’å–å¾—ã™ã‚‹ fetch å‡¦ç†ã¯ä¸¦è¡Œã«è¡Œã‚ã‚Œã¾ã—ãŸã€‚
![alt text](/images/d12e231adbde15/1.png)

React 19 ã‹ã‚‰ã¯ãã†ã§ãªããªã‚‹äºˆå®šã§ã™ã€‚
React 19 ã§ã¯ã€ï¼’ã¤ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ã¾ã¨ã‚ã¦ã²ã¨ã¤ã® Suspense ã«å›²ã‚€ã¨ã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã® fetch ãŒä¸¦è¡Œã«è¡Œã‚ã‚Œãšã€ã‚¦ã‚©ãƒ¼ã‚¿ãƒ¼ãƒ•ã‚©ãƒ¼ãƒ«çŠ¶æ…‹ã«ãªã‚Šã¾ã™ã€‚
![alt text](/images/d12e231adbde15/4.png)

ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ãŒå®Œäº†ã™ã‚‹ã¾ã§ä»¥å‰ã‚ˆã‚Šé•·ã‹ã£ãŸã“ã¨ä½“æ„Ÿã§ãã¾ã—ãŸã€‚

ä¸€ã¤ã® Suspense ã«å›²ã‚“ã ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ä¸­ã§éåŒæœŸå‡¦ç†ã‚’è¡Œã†ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚‚å½±éŸ¿ã—ã¾ã™ã­ã€‚
ä¾‹ã¯ tkdodo ã•ã‚“ãŒç”¨æ„ã—ãŸã‚‚ã®ã‚’å‚ç…§ã—ã¾ã™ã€‚

https://stackblitz.com/edit/tanstack-query-4j1mbu?file=src%2Findex.jsx

```ts
export default function App() {
  return (
    <QueryClientProvider client={queryClient}>
      <React.Suspense fallback={<p>...</p>}>
        <RepoData name='tanstack/query' />
        <RepoData name='tanstack/table' />
      </React.Suspense>
    </QueryClientProvider>
  );
}
```

`<RepoData/>`ã¨ã„ã†ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯ã€å†…å´ã§`useSuspenseQuery`ã‚’ä½¿ã£ã¦ fetch ã‚’è¡Œãªã£ã¦ã„ã¾ã™ã€‚

:::message
`useSuspenseQuery`ã¯ã€`useQuery`ã®æ‹¡å¼µç‰ˆã§ã‚ã‚Šã€`Suspense`ã‚’æœ‰åŠ¹ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã—ã¾ã™ã€‚
:::

React 18 ã§ã¯ä¸¦è¡Œã« fetch ã‚’è¡Œãªã£ã¦ã„ã¾ã™ã€‚
![alt text](/images/d12e231adbde15/image.png)

React 19 ã§ã¯ã€fetch ãŒä¸¦è¡Œã«è¡Œã‚ã‚Œãšã€ã‚¦ã‚©ãƒ¼ã‚¿ãƒ¼ãƒ•ã‚©ãƒ¼ãƒ«çŠ¶æ…‹ã«ãªã‚‹ã“ã¨ç¢ºèªã§ãã¾ã™ã€‚
![alt text](/images/d12e231adbde15/image2.png)

## ã“ã‚Œã‹ã‚‰ã©ã†ã™ã‚‹ã®

ä¿®æ­£[PR](https://github.com/facebook/react/pull/26380) ã®è¨˜è¼‰ã®é€šã‚Šã€fetch ã‚’ hoist ã™ã‚‹ã€ã‚ˆã†ã¯ Suspend ã‚’ã™ã‚‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°å‡¦ç†ä»¥å‰ã«ä½¿ã†ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã‚ã®ã“ã¨ã§ã™ã­ã€‚RSC ä½¿ãˆã‚‹ framework ã¯ã€RSC ã§ ãƒ‡ãƒ¼ã‚¿ã‚’ fetchã€‚Client ã‚ªãƒ³ãƒªãƒ¼ã®ã‚¢ãƒ—ãƒªã¯ã€route loaders ã‚„ãƒã‚¤ãƒ¬ãƒ™ãƒ«ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ fetch ã‚’è¡Œã†ã“ã¨ã‚’å‘¼ã³ã‹ã‘ã¦ã„ã¾ã™ã€‚
https://github.com/facebook/react/pull/26380

:::message
route loader ã¯ã€React Router ã«ãŠã„ã¦ã¯ä»¥ä¸‹ã®æ©Ÿèƒ½ã«è©²å½“ã—ã¾ã™
https://reactrouter.com/en/main/route/loader
tanstack router ã¯ä»¥ä¸‹
https://tanstack.com/router/latest/docs/framework/react/guide/data-loading
:::

React ãƒãƒ¼ãƒ ãŒã©ã†å¯¾å¿œã™ã‚‹ã‹ã¯ã€æ³¨ç›®ã§ã™ ğŸ‘€
